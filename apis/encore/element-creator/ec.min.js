/* -----------------------------------------------
/* Author : NATSKI - natski.dev
/* MIT license : https://opensource.org/license/MIT
/* GitHub : https://github.com/natspooky/encore
/* How to use? : Check the GitHub README or visit https://natski.dev/apis/encore/element-creator
/* ----------------------------------------------- */
import e from"../icon-system/is.min.js";import t from"../dependencies/encoreConsole.js";function jsonElementify(e){if(e&&e.nodeType)return e;if(Array.isArray(e)){let t=[];return e.forEach(e=>{t.push(jsonElementify(e))}),t}let n;if(e.tag){if("text"===e.tag)return document.createTextNode(e.text?e.text:"");n=e.namespace?document.createElementNS(e.namespace,e.tag):document.createElement(e.tag)}return e.innerHTML&&(n.innerHTML=e.innerHTML),e.classes&&(Array.isArray(e.classes)?e.classes.forEach(t=>{t.includes(" ")?e.classes.split(" ").forEach(e=>{n.classList.add(e)}):n.classList.add(t)}):e.classes.split(" ").forEach(e=>{n.classList.add(e)})),e.attributes&&Object.entries(e.attributes).forEach(([e,t])=>{checkExists(t)&&n.setAttribute(e,t)}),e.children&&appendChildren(n,jsonElementify(e.children)),e.events&&Object.entries(e.events).forEach(([e,t])=>{if(t){if(!checkEvent(e)){console.warn(`Event '${e}' is not supported on:`,n);return}Array.isArray(t)?t.forEach(t=>{n.linkEvent(e,functionType(t,n),t.options)}):n.linkEvent(e,functionType(t,n),t.options)}}),e.onAppend&&elementAppended(n,e.onAppend),e.onCreation?.(n),n}function checkEvent(e){if("string"!=typeof e||0==e.length)return!1;let t=document.createElement({select:"input",change:"input",submit:"form",reset:"form",error:"img",load:"img",abort:"img"}[e]||"div"),n=(e="on"+e)in t;return n||(t.setAttribute(e,"return;"),n="function"==typeof t[e]),t=null,n}function render(n,o,s){HTMLElement.prototype.linkEvent=function(e,t,n){this.addEventListener(e,t,n),this.listenerInfo||(this.listenerInfo=[]),this.listenerInfo.push({name:e,callback:t,options:n})},HTMLElement.prototype.getEventListeners=function(){return this.listenerInfo},s?.useIcons&&new e;let r=typeof n,i;if(!("string"===r||"object"===r))throw TypeError("Provided root element is not an element ID or a HTMLElement");if("string"===r&&!(i=document.getElementById(n)))throw Error("Provided root element does not exist in the document");"object"===r&&(i=n);let a=()=>{let e=performance.now();try{appendChildren(i,jsonElementify(o())),t([`Render complete in ${((performance.now()-e)*100).toFixed(0)}ms`,])}catch(n){t(`Render failed:

%c${n}%c`,"error")}};window.addEventListener("DOMContentLoaded",a)}function jsonElementAppend(e,t,n){if(!(e.nodeType&&e.nodeType===Node.ELEMENT_NODE))throw TypeError("Element provided is not a HTML Node");return n?.(destructureElementToJson(e)),t.innerHTML&&(e.innerHTML=t.innerHTML),t.classes&&(Array.isArray(t.classes)?t.classes.forEach(n=>{n.includes(" ")?t.classes.split(" ").forEach(t=>{e.classList.add(t)}):e.classList.add(n)}):t.classes.split(" ").forEach(t=>{e.classList.add(t)})),t.attributes&&Object.entries(t.attributes).forEach(([t,n])=>{checkExists(n)&&e.setAttribute(t,n)}),t.children&&appendChildren(e,jsonElementify(t.children)),t.events&&Object.entries(t.events).forEach(([t,n])=>{n&&(Array.isArray(n)?n.forEach(n=>{e.addEventListener(t,functionType(n,e),n.options)}):e.addEventListener(t,functionType(n,e),n.options))}),t.onAppend&&elementAppended(e,t.onAppend),e}function destructureElementToJson(e){let t={};return t.tag=e.tagName,e.classList.length>0&&(t.classes=e.classList),t}function useDeprecatedMethod(e,t){let n;return e.addEventListener("DOMNodeInserted",n=o=>{o.path.length>1&&o.path[o.length-2]instanceof Document&&(e.removeEventListener("DOMNodeInserted",n),t(e))},!1)}function isAppended(e){for(;e.parentNode;)e=e.parentNode;return e instanceof Document}function elementAppended(e,t){if(isAppended(e)){t(e);return}if(!MutationObserver)return useDeprecatedMethod(e,t);let n=new MutationObserver(o=>{o.forEach(o=>{0!==o.addedNodes.length&&0!==Array.from(o.addedNodes).filter(t=>t.contains(e)).length&&(n.disconnect(),t(e))})});n.observe(document.body,{childList:!0,subtree:!0})}function functionType(e,t){return checkExists(e.param)?Array.isArray(e.param)&&e.param.length>1?"self"===e.param[0]?()=>e.callback(t,...e.param.slice(1)):"event"===e.param[0]?t=>e.callback(t,...e.param.slice(1)):()=>e.callback(...e.param):(Array.isArray(e.param)&&(e.param=e.param[0]),"self"===e.param)?()=>e.callback(t):"event"===e.param?t=>e.callback(t):()=>e.callback(e.param):()=>e.callback()}function checkExists(e){return null!=e}function setFallback(e,t){return checkExists(e)?e:t}function appendChildren(e,t){if(t){if(Array.isArray(t))for(let n of t)e.appendChild(n);else e.appendChild(t)}}function insertChildrenBefore(e,t,n){if(Array.isArray(t))for(let o of t)e.insertBefore(o,n);else e.insertBefore(t,n)}function className(e,...t){return[...t][0]&&(Array.isArray(e)||(e=e.split(" ")),[...t].forEach(t=>{Array.isArray(t)||(t=t.split(" ")),e.push(...t)})),e}class ComponentManager{#a;constructor(){this.#a={}}setComponent(e,t){if(this.getComponent(e))throw Error(`Component ID "${e}" is already assigned`);let n=jsonElementify(t);this.#a[e]={json:t,element:n,type:Array.isArray(n)?"Element Array":"Element"}}getComponent(e){return this.#a?.[e]}getComponents(...e){return[...e].map(e=>this.getComponent(e))}getAllComponents(){return Object.entries(this.#a).map(([,e])=>e)}removeComponent(e){let t=this.getComponent(e).element;if(!t)throw Error(`Component ID "${e}" does not exist`);!Array.isArray(t)&&document.body.contains(t)?t.remove():t.forEach(e=>{document.body.contains(e)&&e.remove()}),delete this.#a[e]}removeComponents(...e){[...e].forEach(e=>this.removeComponent(e))}removeAllComponents(){Object.entries(this.#a).forEach(([e])=>this.removeComponent(e))}changeComponentID(e,t){if(e===t)return;let n=this.getComponent(e),o=this.getComponent(t);if(!n)throw Error(`Component ID "${e}" does not exist`);if(o)throw Error(`Component ID "${t}" is already assigned`);this.setComponent(t,n.json),delete this.#a[e]}replaceComponent(e,t){let n=this.getComponent(e),o=jsonElementify(t);if(!n){this.setComponent(e,t);return}document.body.contains(n.element)&&(console.log(n.element),Array.isArray(n.element)?[...n.element].forEach(e=>{e.replace(...o)}):n.element.replaceWith(o)),this.#a[e]={json:t,element:o,type:Array.isArray(o)?"Element Array":"Element"}}appendComponent(e,t){let n=this.getComponent(t).element;if(!n)throw Error(`Component ID "${t}" does not exist`);appendChildren(e,n)}insertComponentBefore(e,t,n){let o=this.getComponent(t).element;if(!o)throw Error(`Component ID "${t}" does not exist`);insertChildrenBefore(e,o,n)}get componentCount(){return Object.entries(this.#a).length}get componentIDsByType(){let e=[],t=[];return Object.entries(this.#a).forEach(([n,o])=>{"Element"===o.type?e.push(n):t.push(n)}),{Element:e,"Element Array":t}}get componentIDs(){return Object.entries(this.#a).map(([e])=>e)}}export{jsonElementify,jsonElementAppend,checkExists,setFallback,appendChildren,insertChildrenBefore,className,elementAppended,ComponentManager,checkEvent,render};