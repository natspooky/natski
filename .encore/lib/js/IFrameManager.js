import{buildComponent}from"../../apis/encore/element-creator/ec.js";import Navigator from"./navigator.js";export default class FrameManager{#e=[];#t;#a;#i;#r;constructor(e){this.#t=new Navigator(e),this.#i=document.getElementById("embedded-frame"),this.#a=document.getElementById("iframe"),this.#t.show(),window.location.hash.length>2&&this.changeFrame(window.location.href),window.addEventListener("popstate",()=>{window.location.hash.length>2?this.changeFrame(window.location.href):this.closeFrame()})}get frame(){return this.#a}startLoad(){this.#t.widgetCount("right")<1&&this.addWidget("right","loader",Loader())}clearHistory(){this.#e=[],this.removeWidget("left","backButton")}addHistory(){const{page:e}=this.prepareURL();this.#e.push(e),this.addWidget("left","backButton",BackButton())}loadHistory(){this.hash=this.#e.pop()}checkHistory(e){this.#e.includes(e)&&(this.#e.length=this.#e.indexOf(e)),0===this.#e.length&&this.removeWidget("left","backButton")}generateFrame(e){return buildComponent({tag:"iframe",events:{load:{callback:this.removeWidget.bind(this),param:["right","loader"]}},attributes:{id:"iframe",title:e,src:e}})}prepareFrame(e){this.#a.classList.add("closed"),setTimeout(()=>{this.#a.remove(),this.#a=this.generateFrame(e),this.#i.appendChild(this.#a)},305)}closeFrame(){this.removeWidget("right","loader"),this.removeWidget("left","closeButton"),this.#i.classList.remove("active"),this.#t.changeTitle("Home"),this.prepareFrame(""),this.clearHistory(),this.scrollable=!0}changeFrame(e){const t=new URL(e.replace(".html",""));this.#r=new URL(t.protocol+"//"+t.host+t.hash.slice(1)),this.startLoad(),this.scrollable=!1;const{title:a,page:i}=this.prepareURL(),r=`${t.protocol+"//"+this.#r.host+i}.html${this.#r.hash}`;"false"===this.#r.searchParams.get("embed")&&window.open(`${r}?embed=false`,"_self"),this.#t.changeTitle(a),this.prepareFrame(r),this.checkHistory(i),this.#i.classList.add("active"),this.addWidget("left","closeButton",CloseButton())}prepareURL(){let e,t;e=this.#r.pathname.replaceAll("%20","-").replaceAll("_","-");const a=e.split("/");return t=a[a.length-1].split("-").map(e=>e.slice(0,1).toUpperCase()+e.slice(1)).join(" "),{page:e,title:t}}removeWidget(e,t){this.#t.checkWidget(e,t)&&(this.#t.getWidget(e,t).classList.remove("fadein"),setTimeout(()=>{this.#t.removeWidget(e,t),0===this.#t.widgetCount(e)&&this.#t.element.classList.remove(e)},300))}removeAllWidgets(e){Object.entries(this.#t.getWidgetsByDirection(e)).forEach(([t])=>{this.removeWidget(e,t)})}addWidget(e,t,a){this.#t.checkWidget(e,t)||(this.#t.element.classList.add(e),this.#t.addWidget(e,t,a),setTimeout(()=>{this.#t.getWidget(e,t).classList.add("fadein")},200))}set hash(e){window.location.hash=e}set scrollable(e){e?(document.body.style.overflow="unset",document.body.ontouchmove=function(){return!0}):(document.body.style.overflow="hidden",document.body.ontouchmove=function(e){e.preventDefault()})}}