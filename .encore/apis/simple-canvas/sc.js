const append=new Event("append");export default class SimpleCanvas{#t=["mousedown","mouseup","mousemove","mouseenter","mouseleave","dblclick","click","contextmenu","auxclick","touchstart","touchend","touchmove","touchcancel","keyup","keydown","wheel","scroll","scrollend","blur","focus","resize"].filter(this.#e);#s={};#i={};#a={scrolling:!1};#n={scrolling:!1};#o={pressing:!1,pressCount:0};#r={pressed:!1,covering:!1,click:{startPosition:{},endPosition:{}},motion:{position:{x:void 0,y:void 0},lastPostion:{x:void 0,y:void 0},velocity:{x:0,y:0},acceleration:{x:0,y:0},speed:0}};#h={touching:!1,touchCount:0};#c={canvas:void 0,context:void 0,id:void 0,size:{width:300,height:150,locked:!1,scale:window.devicePixelRatio||1}};#d={paused:!1,drawing:!1,renderTime:0,interval:1e3/60,runTime:0,drawFn:void 0,setupFn:void 0,resizeFn:void 0,appendFn:void 0};#u={fps:{frameBuffer:[],renderBuffer:0,renderBufferTwo:0,currentFPS:0}};#l={motionState:void 0,wheelMotionState:void 0,scrollMotionState:void 0};constructor(t,e={},s="Unnamed Canvas"){switch(this.#v(e),typeof t){case"string":this.#c.canvas=document.getElementById(t),this.#c.canvas||SimpleCanvas.console({message:"Assignment error:",error:`The ID '${t}' does not exist in the DOM`});break;case"object":if("CANVAS"!==t.tagName||t.nodeType!==Node.ELEMENT_NODE)return void SimpleCanvas.console({message:"Assignment error:",error:"HTML Node is not a 'CANVAS'"});this.#c.canvas=t;break;default:SimpleCanvas.console({message:"Type error:",error:"Passed canvas is not of type HTML Node or String ID"})}if(this.#c.context=this.#c.canvas.getContext("2d"),this.#c.id=s,this.#m(),!document.body.contains(this.#c.canvas))return this.#c.canvas.addEventListener("append",()=>{this.#p(),this.#d.appendFn?.()},{once:!0}),void this.#g(this.#c.canvas);this.#p()}static create(t,e,s="Unnamed Canvas"){const i=document.createElement("canvas");return t.split(" ").forEach(t=>{switch(t.slice(0,1)){case"#":i.id=t.slice(1);break;case".":i.classList.add(t.slice(1));break;default:SimpleCanvas.console({message:"Assignment error:",error:"Class and ID keys dont match required syntax: (#Id .class)"})}}),new SimpleCanvas(i,e,s)}static console(t){Array.isArray(t)||(t=[t]);t.forEach(t=>{t&&console.log(`%cSimple-Canvas%c ${t.message}${t.error||t.warn?"\n%c"+(t.error||t.warn)+"%c":""}`,"font-weight: bold; color: #29a36aff; background-color: black; padding: 0 5px; border-radius: 7px; border: 1px solid #29a36aff","font-weight: normal;",...(t=>t.error?["background-color: #ff000049; padding: 3px 5px; border-radius: 7px;","font-weight: normal;"]:t.warn?["background-color: #ffff0049; padding: 3px 5px; border-radius: 7px;","font-weight: normal;"]:[])(t))})}async render(){this.#d.drawFn?document.body.contains(this.#c.canvas)?(await(this.#d.setupFn?.()),SimpleCanvas.console({message:`Rendering '${this.#c.id}' at ${this.settings.fps}fps`}),this.#d.drawing=!0,this.#f()):SimpleCanvas.console({message:"Render error:",error:"Canvas cannot render content while outside of the Document body"}):SimpleCanvas.console({message:"Render error:",error:"No draw function provided"})}paintAll(t){this.#S(e=>{t&&(e.fillStyle=t),e.fillRect(0,0,e.canvas.width,e.canvas.height)})}disconnect(){this.#w()}pause(){this.#d.paused=!0}play(){this.#d.paused=!1}setup(t){this.#d.setupFn=t}append(t){this.#d.appendFn=t}draw(t){this.#d.drawFn=t}resize(t){this.#d.resizeFn=t}set size({height:t,width:e}){this.settings.size.locked=!0}set fps(t){new Promise(t=>requestAnimationFrame(e=>requestAnimationFrame(s=>t(Math.floor(1e3/(s-e)))))).then(e=>{const s=[30,60,75,90,100,120,144,180,240,360].reduce((t,s)=>Math.abs(s-e)<Math.abs(t-e)?s:t);t=Math.min(t,s),this.settings.fps=t,this.#d.interval=1e3/t})}get fps(){return this.settings.fps}on(t,e){this.#t.includes(t)||SimpleCanvas.console({message:"Event warning:",warn:`'${t}' is not supported in Simple Canvas`}),this.#s[t]=e}removeEvent(t){this.#t.includes(t)||console.log("uh oh"),delete this.#s[t]}#v(t){this.settings={fps:60,autoClear:!0,autoResize:!0,setupOnResize:!0,useCursor:!1,useTouch:!1,useWheel:!1,useScroll:!1,useKey:!1,diagnostics:!1,detectWindowFocus:!0,debugConsole:!1,...t},this.fps=this.settings.fps,this.settings.size&&(this.#c.size.locked=!0,this.#c.size.width=this.settings.size.width,this.#c.size.height=this.settings.size.height)}#e(t){if("string"!=typeof t||0==t.length)return!1;let e=document.createElement({select:"input",change:"input",submit:"form",reset:"form",error:"img",load:"img",abort:"img"}[t]||"div"),s=(t="on"+t)in e;return s||(e.setAttribute(t,"return;"),s="function"==typeof e[t]),e=null,s}#E({target:t,eventName:e,fn:s,options:i}){if(!this.#t.includes(e))return;const a=s.bind(this);t.addEventListener(e,a,i),this.#i[e]=()=>t.removeEventListener(e,a)}#w(t){t?this.#i[t]?.():Object.values(this.#i).forEach(t=>t())}#m(){if(this.settings.useCursor&&(this.#E({target:this.#c.canvas,eventName:"mouseup",fn:this.#b,options:{passive:!0}}),this.#E({target:document,eventName:"mousedown",fn:this.#y}),this.#E({target:document,eventName:"mousemove",fn:this.#k,options:{passive:!0}}),this.#E({target:this.#c.canvas,eventName:"contextmenu",fn:this.#z}),this.#E({target:this.#c.canvas,eventName:"mouseenter",fn:this.#C,options:{passive:!0}}),this.#E({target:this.#c.canvas,eventName:"mouseleave",fn:this.#T,options:{passive:!0}})),this.settings.useTouch&&(this.#E({target:this.#c.canvas,eventName:"touchstart",fn:this.#x}),this.#E({target:document,eventName:"touchend",fn:this.#L,options:{passive:!0}}),this.#E({target:this.#c.canvas,eventName:"touchmove",fn:this.#N}),this.#E({target:document,eventName:"touchcancel",fn:this.#D})),this.settings.useKey&&(this.#E({target:document,eventName:"keyup",fn:this.#M,options:{passive:!0}}),this.#E({target:document,eventName:"keydown",fn:this.#F})),this.settings.useWheel&&this.#E({target:this.#c.canvas,eventName:"wheel",fn:this.#R}),this.settings.useScroll&&this.#E({target:document,eventName:"scroll",fn:this.#P}),this.settings.autoResize){const t=this.#p.bind(this);new ResizeObserver(()=>t()).observe(this.#c.canvas)}this.#E({target:window,eventName:"resize",fn:this.#A,options:{passive:!0}}),this.settings.detectWindowFocus&&(this.#E({target:window,eventName:"blur",fn:this.#B}),this.#E({target:window,eventName:"focus",fn:this.#U}))}#g(t){if((t=>{for(;t.parentNode;)t=t.parentNode;return t instanceof Document})(t))return void t.dispatchEvent(append);const e=new MutationObserver(s=>{for(const i of s)0!==i.addedNodes.length&&Array.from(i.addedNodes).some(e=>e.contains(t))&&(e.disconnect(),t.dispatchEvent(append))});e.observe(document.body,{childList:!0,subtree:!0})}#B(){this.#d.paused=!0}#U(){this.#d.paused=!1}#A(){const t=this.#c.canvas.getBoundingClientRect(),e=document.body,s=document.documentElement,i=s.scrollTop||e.scrollTop,a=s.scrollLeft||e.scrollLeft,n=s.clientTop||e.clientTop||0,o=s.clientLeft||e.clientLeft||0;this.#c.dimensions.position={x:Math.round(t.left+a-o),y:Math.round(t.top+i-n)}}async#p(){this.#W(),this.#A(),this.settings.setupOnResize&&this.settings.autoResize&&await(this.#d.setupFn?.()),this.#d.resizeFn?.({width:this.#c.size.width,height:this.#c.size.height}),this.#d.drawing&&!this.#d.paused&&this.#q()}#y(t){this.#r.covering&&(t.preventDefault(),this.#r.pressed=!0,this.#r.click.startPosition=this.#r.motion.position,this.#s.mousedown?.(t))}#b(t){this.#r.pressed&&(this.#r.pressed=!1,this.#r.click.endPosition=this.#r.motion.position,this.#s.mouseup?.(t))}#k(t){this.#r.covering&&(this.#r.motion.lastPostion=this.#r.motion.position,clearTimeout(this.#l.motionState),this.#r.moving=!0,this.#l.motionState=setTimeout(()=>{this.#r.moving=!1},10),this.#s.mousemove?.(t))}#z(t){t.preventDefault()}#C(t){this.#r.covering=!0,this.#s.mouseenter?.(t)}#T(t){this.#r.covering=!1,this.#s.mouseleave?.(t)}#x(t){this.#h.touching=!0,this.#h.touchCount++,this.#s.touchstart?.(t)}#L(t){this.#h.touchCount--,this.#h.touchCount<=0&&(this.#h.touching=!0),this.#s.touchend?.(t)}#N(t){clearTimeout(this.#l.motionState),this.#h.moving=!0,this.#l.motionState=setTimeout(()=>{this.#h.moving=!1},10),this.#s.touchmove?.(t)}#D(t){this.#s.touchcancel?.(t)}#F(t){this.#o.pressed=!0,this.#o.pressedCount++,this.#s.keydown?.(t)}#M(t){this.#o.pressedCount--,this.#o.pressedCount<=0&&(this.#o.pressed=!1),this.#s.keyup?.(t)}#R(t){t.preventDefault(),clearTimeout(this.#l.wheelMotionState),this.#a.scrolling=!0,this.#l.wheelMotionState=setTimeout(()=>{this.#a.scrolling=!1},10),this.#s.wheel?.(t)}#P(t){clearTimeout(this.#l.wheelMotionState),this.#n.scrolling=!0,this.#l.wheelMotionState=setTimeout(()=>{this.#n.scrolling=!1},10),this.#s.scroll?.(t)}#W(){this.#c.size.locked||(this.#c.size.width=Math.floor(this.#c.canvas.offsetWidth*this.#c.size.scale),this.#c.size.height=Math.floor(this.#c.canvas.offsetHeight*this.#c.size.scale)),this.#c.canvas.width=this.#c.size.width,this.#c.canvas.height=this.#c.size.height}#q(){this.settings.autoClear&&this.#O(),this.#d.drawFn(),this.settings.diagnostics&&this.#I()}async#f(){let t=performance.now(),e=0,s=0;for(;this.#d.drawing;)s=await new Promise(requestAnimationFrame),s-t<this.#d.interval-e||(e=Math.min(this.#d.interval,e+s-t-this.#d.interval),this.#d.paused||(this.#d.renderTime=(s-t)/1e3,this.#d.runTime+=this.#d.renderTime,t=s,this.#q()))}#O(){this.#S(t=>{t.clearRect(0,0,t.canvas.width,t.canvas.height)})}#I(){this.#S(t=>{this.#$(t),this.#H(t)})}#j({width:t,height:e,padding:s,clip:i,child:a,fn:n,round:o,parentData:r}){}#$(t){const e=100,s=20,i=10;this.#u.fps.renderBufferTwo>=1?(this.#u.fps.currentFPS=this.#u.fps.renderBuffer,this.#u.fps.renderBuffer=0,this.#u.fps.renderBufferTwo=0):(this.#u.fps.renderBuffer++,this.#u.fps.renderBufferTwo+=this.#d.renderTime);const a=this.#u.fps.currentFPS+"/"+this.settings.fps+"fps",n=110+2*a.length;this.#u.fps.frameBuffer.length>=50&&this.#u.fps.frameBuffer.shift(),this.#u.fps.frameBuffer.push(this.#d.renderTime),t.fillStyle="#00000090",t.font="30px monospace",t.beginPath(),t.roundRect(20,20,n+15*a.length+20,60,[15]),t.fill(),t.beginPath(),t.roundRect(30,30,e,40,[5]),t.fill(),t.strokeStyle="#ffffff",t.fillStyle="#ffffff",t.fillText(a,140,60);let o=new Path2D;o.roundRect(30,30,e,40,[5]),t.clip(o),t.beginPath(),this.#u.fps.frameBuffer.forEach((a,n,o)=>{const r=Math.max(0,40-this.#d.interval/(1e3*a)*40),h=e/o.length*n+s+i;0!==n?t.lineTo(h,r+i+s):t.moveTo(h,r+i+s)}),t.stroke()}#H(t){}#S(t){const e=this.context;e.save(),e.setTransform(1,0,0,1,0,0),t(e),e.restore()}get element(){return this.#c.canvas}get context(){return this.#c.context}get width(){return this.#c.size.width}get height(){return this.#c.size.height}get cursor(){return{pressed:this.#r.pressed}}}class CanvasElement{#K;#V;#_;#G;constructor({width:t,height:e,useDPI:s,type:i,clip:a,top:n,left:o,context:r,children:h}){}move({x:t,y:e}){}absoluteMove(){}draw(){type,this.#G.forEach(t=>t.draw())}}