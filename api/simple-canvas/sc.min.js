/* -----------------------------------------------
/* Author : NATSKI - natski.net
/* MIT license : https://opensource.org/license/MIT
/* GitHub : https://github.com/natspooky/simple-canvas
/* How to use? : Check the GitHub README or visit https://natski.net/api/simple-canvas
/* ----------------------------------------------- */

export default class s{#a={drawState:{drawing:!1,paused:{user:!1,intersection:!1,focus:!1}},observer:{resize:!0,intersection:!1},canvas:{clear:!1},fps:{set:30,interval:1e3/30},events:{mouse:!1,touch:!1,wheel:!1,keyboard:!1,focus:!0},eventSupport:{touch:"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0,wheel:"onwheel"in document,hover:window.matchMedia("(hover: hover)").matches},diagnostic:{positionLayerData:!1,fpsData:!1,cursorData:!1,keyboardData:!1,transformData:!1,overlayData:!1,data:{currentFPS:0,frameDelta:[],fpsBuffer:0,fpsBufferTwo:0}},sizing:{isFixedSize:!1,fixedSize:{x:0,y:0},retinaSize:window.devicePixelRatio>1?window.devicePixelRatio:1},renderMode:{click:{move:!1,down:!1,up:!1},touch:{move:!1,down:!1,up:!1},wheel:!1,keyboard:{down:!1,up:!1},frameRate:!0}};#b={keys:{},events:{pressed:!1,repeating:!1},e:{key:"c",code:"KeyC",location:0,altKey:!1,ctrlKey:!0,metaKey:!1,shiftKey:!1,repeat:!1}};#c={position:{current:{x:0,y:0},previous:{x:0,y:0},click:{start:{x:0,y:0},end:{x:0,y:0}}},events:{pressed:!1,hover:!1,moving:!1},kinematics:{acceleration:{x:0,y:0},velocity:{x:0,y:0},speed:0}};#d={events:{scrolling:!1}};#e={dimensions:{position:{x:0,y:0},size:{DOMSize:{x:0,y:0},canvasSize:{x:0,y:0},transformSize:{top:0,left:0,width:0,height:0}},ratio:{DOMAspectRatio:0,canvasAspectRatio:0,transformAspectRatio:0}},transform:{current:{scale:{x:1,y:1},translate:{x:0,y:0}},saved:{scale:{x:1,y:1},translate:{x:0,y:0}}},time:{runTime:0,render:0}};#f={observers:[],events:[]};#g={user:{},observer:{}};#h={mouseMove:0,wheel:0,intersection:0};constructor(s,t){let e;if("object"==typeof s&&s.nodeType===Node.ELEMENT_NODE)e=s;else if("string"==typeof s){if(null===(e=document.getElementById(s)))throw Error("element ID has no corresponding HTMLElement")}else throw Error("input is not a valid HTMLElement");this.#e.body=e,this.#e.context=e.getContext("2d"),this.#i(t),this.#j(),this.#k()}static create(t,e){if("string"!=typeof t)throw Error("cannot asign ID or class to canvas element");let i=document.createElement("canvas");for(let n of t=t.split(" "))switch(n.slice(0,1)){case"#":i.id=n.slice(1,n.length);break;case".":i.classList.add(n.slice(1,n.length));break;default:throw Error("entry is not an ID or Class")}return new s(i,e)}#i(t){var e,i,n,a,o,r,c,h,u,v,l,m,d,f,g,z,p;let $=s=>null!=s&&s;null!=(e=t.fps)&&e&&(this.#a.fps.set=t.fps,this.#a.fps.interval=1e3/t.fps),this.#a.canvas.clear=!!(null!=(i=t.autoClear)&&i)&&t.autoClear,this.#a.events.mouse=!!(null!=(n=t.useCursor)&&n)&&t.useCursor,this.#a.events.touch=!!(null!=(a=t.useTouch)&&a)&&t.useTouch,this.#a.events.wheel=!!(null!=(o=t.useWheel)&&o)&&t.useWheel,this.#a.events.keyboard=!!(null!=(r=t.useKeyboard)&&r)&&t.useKeyboard,this.#a.events.focus=!(null!=(c=t.detectWindowFocus)&&c)||t.detectWindowFocus,this.#a.diagnostic.positionLayerData=!!(null!=(h=t.showLayerPosition)&&h)&&t.showLayerPosition,this.#a.diagnostic.fpsData=!!(null!=(u=t.calculateFPS)&&u)&&t.calculateFPS,this.#a.diagnostic.cursorData=!!(null!=(v=t.calculateCursor)&&v)&&t.calculateCursor,this.#a.diagnostic.keyboardData=!!(null!=(l=t.calculateKeyboard)&&l)&&t.calculateKeyboard,this.#a.diagnostic.cursorData=!!(null!=(m=t.calculateCursor)&&m)&&t.calculateCursor,this.#a.diagnostic.transformData=!!(null!=(d=t.calculateTransform)&&d)&&t.calculateTransform,this.#a.diagnostic.overlayData=!!(null!=(f=t.calculateOverlay)&&f)&&t.calculateOverlay,this.#a.observer.resize=!(null!=(g=t.detectResize)&&g)||t.detectResize,this.#a.observer.intersection=!!(null!=(z=t.detectIntersection)&&z)&&t.detectIntersection,null!=(p=t.size)&&p&&(this.#a.sizing.isFixedSize=!0,this.#a.sizing.fixedSize=t.size,this.#e.dimensions.size.canvasSize=t.size)}get element(){return this.#e.body}get context(){return this.#e.context}get DOMSize(){return this.#e.dimensions.size.DOMSize}get canvasSize(){return this.#e.dimensions.size.canvasSize}get transformSize(){return this.#e.dimensions.size.transformSize}get DOMAspectRatio(){return this.#e.dimensions.ratio.DOMAspectRatio}get canvasAspectRatio(){return this.#e.dimensions.ratio.canvasAspectRatio}get transformAspectRatio(){return this.#e.dimensions.ratio.transformAspectRatio}get cursor(){return this.#c}get cursorEvents(){return this.#c.events}get cursorPosition(){return this.cursor.position.current}get cursorPreviousPosition(){return this.#c.position.previous}get cursorClickPosition(){return this.#c.position.click}get keyboard(){return this.#b}get canvasScale(){return this.#e.transform.current.scale}get canvasTranslate(){return this.#e.transform.current.translate}get renderTime(){return this.#e.time.render}get runTime(){return this.#e.time.runTime}set fps(s){this.#a.fps.set=s,this.#a.fps.interval=1e3/s}set size(s){this.#e.dimensions.size.canvasSize=s,this.#a.sizing.fixedSize=s,this.#a.sizing.isFixedSize=!0,this.#k()}mouseMove(s){this.#g.user.mouseMove=s}mouseEnter(s){this.#g.user.mouseEnter=s}mouseLeave(s){this.#g.user.mouseLeave=s}mouseDown(s){this.#g.user.mouseDown=s}mouseUp(s){this.#g.user.mouseUp=s}touchStart(s){this.#g.user.touchStart=s}touchEnd(s){this.#g.user.touchEnd=s}touchMove(s){this.#g.user.touchMove=s}wheel(s){this.#g.user.wheel=s}leftClick(s){this.#g.user.leftClick=s}rightClick(s){this.#g.user.rightClick=s}middleClick(s){this.#g.user.middleClick=s}keyDown(s){this.#g.user.keyDown=s}keyUp(s){this.#g.user.keyUp=s}resize(s){this.#g.user.resize=s}#l(S){this.#c.position.previous=this.#c.position.current,this.#a.sizing.isFixedSize?this.#c.position.current=this.#m(S):this.#c.position.current=this.#n(S),clearTimeout(this.#h.mouseMove),this.#c.events.moving=!0,this.#h.mouseMove=setTimeout(()=>{this.#c.events.moving=!1},10),this.#g.user.mouseMove&&this.#g.user.mouseMove()}#n(y){return{x:(y.pageX-this.#e.dimensions.position.x)/(this.#e.transform.current.scale.x/this.#a.sizing.retinaSize)+this.#e.dimensions.size.transformSize.left,y:(y.pageY-this.#e.dimensions.position.y)/(this.#e.transform.current.scale.y/this.#a.sizing.retinaSize)+this.#e.dimensions.size.transformSize.top}}#m(x){return{x:(x.pageX-this.#e.dimensions.position.x)/(this.#e.dimensions.size.DOMSize.x/this.#e.dimensions.size.canvasSize.x*this.#e.transform.current.scale.x)+this.#e.dimensions.size.transformSize.left,y:(x.pageY-this.#e.dimensions.position.y)/(this.#e.dimensions.size.DOMSize.y/this.#e.dimensions.size.canvasSize.y*this.#e.transform.current.scale.y)+this.#e.dimensions.size.transformSize.top}}#o(_){this.#c.events.hover=!0,this.#g.user.mouseEnter&&this.#g.user.mouseEnter()}#p(w){this.#c.events.hover=!1,this.#g.user.mouseLeave&&this.#g.user.mouseLeave()}#q(b){this.#c.events.pressed=!0,this.#g.user.mouseDown&&this.#g.user.mouseDown()}#r(D){this.#c.events.pressed=!1,this.#g.user.mouseUp&&this.#g.user.mouseUp()}#s(E){switch(E.button){case 0:this.#g.user.leftClick&&this.#g.user.leftClick();break;case 1:this.#g.user.rightClick&&this.#g.user.rightClick();break;case 2:this.#g.user.middleClick&&this.#g.user.middleClick()}}#t(k){k.preventDefault()}#u(T){T.preventDefault(),this.#d.events.scrolling=!0,clearTimeout(this.#h.wheel),this.#h.wheel=setTimeout(()=>{this.#d.events.scrolling=!1},10),this.#g.user.wheel&&this.#g.user.wheel()}#v(O){O.preventDefault(),this.#g.user.touchMove&&this.#g.user.touchMove()}#w(M){this.#g.user.touchStart&&this.#g.user.touchStart()}#x(F){this.#g.user.touchMove&&this.#g.user.touchStart()}#y(C){this.#g.user.keyUp&&this.#g.user.keyUp()}#z(R){this.#b.current=R.key,this.#g.user.keyDown&&this.#g.user.keyDown()}#A(){this.#B()}#C(){this.#k(),this.#D(),this.#g.user.resize&&this.#g.user.resize(),this.#g.user.draw&&this.#g.user.draw(),this.#a.diagnostic.overlayData&&this.#E()}#D(){this.#e.context.scale(this.#e.transform.current.scale.x,this.#e.transform.current.scale.y),this.#e.context.translate(this.#e.transform.current.translate.x,this.#e.transform.current.translate.y)}#F(N){N.forEach(s=>{s.intersectionRatio>=.2?(clearTimeout(this.#h.intersection),this.#a.drawState.paused.intersection=!1):this.#h.intersection=setTimeout(()=>{this.#a.drawState.paused.intersection=!0},200)})}#G(){this.#a.drawState.paused.focus=!1}#H(){this.#a.drawState.paused.focus=!0}save(){this.#e.transform.saved=this.#e.transform.current,this.#e.context.save()}restore(){this.#e.transform.current=this.#e.transform.saved,this.#e.context.restore(),this.#I()}reset(){this.#e.transform.current=this.#e.transform.saved=this.#J(),this.#e.context.reset(),this.#I()}clear(){this.#e.context.clearRect(this.#e.dimensions.size.transformSize.left,this.#e.dimensions.size.transformSize.top,this.#e.dimensions.size.transformSize.width,this.#e.dimensions.size.transformSize.height)}paint(s){this.save(),void 0!==s&&(this.#e.context.fillStyle=s),this.#e.context.fillRect(this.#e.dimensions.size.transformSize.left,this.#e.dimensions.size.transformSize.top,this.#e.dimensions.size.transformSize.width,this.#e.dimensions.size.transformSize.height),this.restore()}scale(s,t){this.#e.context.scale(s,t),this.#e.transform.current.scale.x*=s,this.#e.transform.current.scale.y*=t,this.#I()}translate(s,t){this.#e.context.translate(s,t),this.#e.transform.current.translate.x+=s*this.#e.transform.current.scale.x,this.#e.transform.current.translate.y+=t*this.#e.transform.current.scale.y,this.#I()}resetTransform(){this.#e.context.resetTransform(),this.#e.transform.current=this.#J(),this.#I()}#J(){return this.#a.sizing.isFixedSize?{scale:{x:1,y:1},translate:{x:0,y:0}}:{scale:{x:1*this.#a.sizing.retinaSize,y:1*this.#a.sizing.retinaSize},translate:{x:0,y:0}}}setup(s){this.#g.user.setup=s}draw(s){this.#g.user.draw=s,this.#k(),this.#g.user.setup&&this.#g.user.setup(),this.#a.drawState.drawing||(this.#a.drawState.drawing=!0,this.#K())}async #K(){let L=performance.now(),P=0,A=0;for(;this.#a.drawState.drawing;)A=await new Promise(requestAnimationFrame),!this.#a.drawState.paused.user&&!this.#a.drawState.paused.intersection&&!this.#a.drawState.paused.focus&&!(A-L<this.#a.fps.interval-P)&&(this.#e.time.render=(A-L)/1e3,this.#e.time.runTime+=this.#e.time.render,P=Math.min(this.#a.fps.interval,P+A-L-this.#a.fps.interval),L=A,this.#a.canvas.clear&&this.clear(),this.#g.user.draw(),this.#a.diagnostic.overlayData&&this.#E())}#E(){this.save(),this.#e.context.font="24px serif",this.#a.diagnostic.positionLayerData&&this.#L(),this.resetTransform(),this.#e.context.fillStyle=this.#e.context.strokeStyle="#ffffff",this.#a.diagnostic.fpsData&&this.#M(),this.#a.diagnostic.cursorData&&this.#N(),this.#a.diagnostic.keyboardData&&this.#O(),this.#a.diagnostic.transformData&&this.#P(),this.restore()}#L(){this.#e.context.fillStyle=this.#e.context.strokeStyle="#0000ff",this.#e.context.strokeRect(this.#e.dimensions.size.transformSize.left,this.#e.dimensions.size.transformSize.top,this.#e.dimensions.size.transformSize.width,this.#e.dimensions.size.transformSize.height),this.#e.context.beginPath(),this.#e.context.moveTo(this.#e.dimensions.size.transformSize.left,this.#e.dimensions.size.transformSize.top),this.#e.context.lineTo(this.#e.dimensions.size.transformSize.left+this.#e.dimensions.size.transformSize.width,this.#e.dimensions.size.transformSize.top+this.#e.dimensions.size.transformSize.height),this.#e.context.stroke(),this.#e.context.fillText("Transform",this.#e.dimensions.size.transformSize.left+10,this.#e.dimensions.size.transformSize.top+this.#e.dimensions.size.transformSize.height-10),this.#e.context.fillStyle=this.#e.context.strokeStyle="#00ff00",this.#e.context.strokeRect(0,0,this.#e.dimensions.size.canvasSize.x,this.#e.dimensions.size.canvasSize.y),this.#e.context.beginPath(),this.#e.context.moveTo(0,this.#e.dimensions.size.canvasSize.y),this.#e.context.lineTo(this.#e.dimensions.size.canvasSize.x,0),this.#e.context.stroke(),this.#e.context.fillText("Canvas",this.#e.dimensions.size.canvasSize.x-80,this.#e.dimensions.size.canvasSize.y-10),this.#e.context.fillStyle=this.#e.context.strokeStyle="#ff0000",this.#e.context.strokeRect(0,0,this.#e.dimensions.size.DOMSize.x,this.#e.dimensions.size.DOMSize.y),this.#e.context.beginPath(),this.#e.context.moveTo(0,0),this.#e.context.lineTo(this.#e.dimensions.size.DOMSize.x,this.#e.dimensions.size.DOMSize.y),this.#e.context.stroke(),this.#e.context.fillText("Document",this.#e.dimensions.size.DOMSize.x-110,25)}#M(){this.#e.context.fillStyle="#00000040",this.#e.context.fillRect(10,10,210,70),this.#e.context.fillStyle="#ffffff",this.#a.diagnostic.data.fpsBufferTwo>=1?(this.#a.diagnostic.data.currentFPS=this.#a.diagnostic.data.fpsBuffer,this.#a.diagnostic.data.fpsBuffer=0,this.#a.diagnostic.data.fpsBufferTwo=0):(this.#a.diagnostic.data.fpsBuffer++,this.#a.diagnostic.data.fpsBufferTwo+=this.#e.time.render),this.#a.diagnostic.data.frameDelta.length>=50&&this.#a.diagnostic.data.frameDelta.shift(),this.#a.diagnostic.data.frameDelta.push(Math.min(this.#a.fps.set*this.#e.time.render,50)),this.#a.diagnostic.data.frameDelta.forEach((s,t)=>{this.#e.context.fillRect(t+20,70-s,1,s)}),this.#e.context.fillText(`current: ${this.#a.diagnostic.data.currentFPS}`,90,65),this.#e.context.fillText(`target: ${this.#a.fps.set}`,90,40)}#N(){}#O(){}#P(){}#Q(B){this.#g.observer[B.observerName]=new B.observerName(B.observerFunction.bind(this),B.observerOptions),this.#g.observer[B.observerName].observe(B.targetElement),this.#f.observers.push(B)}#R(){let U=[];for(let K=1;K<=50;K++){let I=K/50;U.push(I)}return U.push(0),U}#S(){this.#f.observers.forEach(s=>{this.#g.observer[s.observerName].disconnect()})}#T(W){W.hostElement.addEventListener(W.eventName,W.eventFunction.bind(this),W.eventOptions),this.#f.events.push(W)}#U(){this.#f.events.forEach(s=>{s.hostElement.removeEventListener(s.eventName,s.eventFunction.bind(this))})}#j(){this.#a.observer.resize&&(this.#Q({observerName:ResizeObserver,observerFunction:this.#C,observerOptions:"",targetElement:this.#e.body}),this.#T({hostElement:window,eventName:"resize",eventFunction:this.#A,eventOptions:!1})),this.#a.observer.intersection&&this.#Q({observerName:IntersectionObserver,observerFunction:this.#F,observerOptions:{root:null,rootMargin:"0px",threshold:this.#R()},targetElement:this.#e.body}),this.#a.events.focus&&(this.#T({hostElement:window,eventName:"focus",eventFunction:this.#G,eventOptions:!1}),this.#T({hostElement:window,eventName:"blur",eventFunction:this.#H,eventOptions:!1})),this.#a.events.keyboard&&(this.#T({hostElement:document,eventName:"keyup",eventFunction:this.#y,eventOptions:!1}),this.#T({hostElement:document,eventName:"keydown",eventFunction:this.#z,eventOptions:!1})),this.#a.events.scroll&&this.#a.eventSupport.wheel&&this.#T({hostElement:this.#e.body,eventName:"wheel",eventFunction:this.#u,eventOptions:!0}),this.#a.events.mouse&&(this.#a.eventSupport.hover&&(this.#T({hostElement:this.#e.body,eventName:"mouseenter",eventFunction:this.#o,eventOptions:!1}),this.#T({hostElement:this.#e.body,eventName:"mouseleave",eventFunction:this.#p,eventOptions:!1})),this.#T({hostElement:this.#e.body,eventName:"mousemove",eventFunction:this.#l,eventOptions:!1}),this.#T({hostElement:this.#e.body,eventName:"mousedown",eventFunction:this.#q,eventOptions:!1}),this.#T({hostElement:document,eventName:"mouseup",eventFunction:this.#r,eventOptions:!1}),this.#T({hostElement:this.#e.body,eventName:"click",eventFunction:this.#s,eventOptions:!1}),this.#T({hostElement:this.#e.body,eventName:"contextmenu",eventFunction:this.#t,eventOptions:!1})),this.#a.events.touch&&this.#a.eventSupport.touch&&(this.#T({hostElement:this.#e.body,eventName:"touchstart",eventFunction:this.#w,eventOptions:!1}),this.#T({hostElement:this.#e.body,eventName:"touchend",eventFunction:this.#x,eventOptions:!1}),this.#T({hostElement:this.#e.body,eventName:"touchmove",eventFunction:this.#v,eventOptions:!0}))}#k(){this.#V(),this.#W(),this.#I(),this.#B()}#V(){this.#e.dimensions.size.DOMSize={x:this.#e.body.offsetWidth,y:this.#e.body.offsetHeight},this.#e.dimensions.ratio.DOMAspectRatio=this.#e.dimensions.size.DOMSize.x/this.#e.dimensions.size.DOMSize.y}#W(){this.save(),this.#a.sizing.isFixedSize?this.#e.dimensions.size.canvasSize=this.#a.sizing.fixedSize:(this.#e.dimensions.size.canvasSize.x=this.#e.dimensions.size.DOMSize.x*this.#a.sizing.retinaSize,this.#e.dimensions.size.canvasSize.y=this.#e.dimensions.size.DOMSize.y*this.#a.sizing.retinaSize),this.#e.dimensions.ratio.canvasAspectRatio=this.#e.dimensions.size.canvasSize.x/this.#e.dimensions.size.canvasSize.y,this.#e.body.width=this.#e.dimensions.size.canvasSize.x,this.#e.body.height=this.#e.dimensions.size.canvasSize.y,this.restore()}#I(){this.#e.dimensions.size.transformSize={top:0-this.#e.transform.current.translate.y,left:0-this.#e.transform.current.translate.x,height:this.#e.dimensions.size.canvasSize.y/this.#e.transform.current.scale.y,width:this.#e.dimensions.size.canvasSize.x/this.#e.transform.current.scale.x},this.#e.dimensions.ratio.transformAspectRatio=this.#e.dimensions.size.transformSize.width/this.#e.dimensions.size.transformSize.height}#B(){let H=this.#e.body.getBoundingClientRect(),V=document.body,X=document.documentElement,Y=X.scrollTop||V.scrollTop,j=X.scrollLeft||V.scrollLeft,q=X.clientTop||V.clientTop||0,G=X.clientLeft||V.clientLeft||0;this.#e.dimensions.position={x:Math.round(H.left+j-G),y:Math.round(H.top+Y-q)}}disconnect(){this.endDraw(),this.#S(),this.#U()}endDraw(){this.#a.drawState.drawing=!1}pause(){this.#a.drawState.paused.user=!0}play(){this.#a.drawState.paused.user=!1}};